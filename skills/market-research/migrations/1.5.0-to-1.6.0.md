# Migration: market-research v1.5.0 → v1.6.0

v1.6.0 adds Text Fragment URLs to all source links so they scroll to and highlight the
quoted passage in the reader's browser.

---

## What Changed

In v1.5.0, quote source URLs pointed to the page containing the quote:
```
[r/productivity](https://reddit.com/r/productivity/abc123)
```

In v1.6.0, source URLs include a text fragment directive that highlights the quote:
```
[r/productivity](https://reddit.com/r/productivity/abc123#:~:text=I%20tried%20everything)
```

---

## Recommendation

**Rerun the skill from scratch** for the full v1.6.0 experience. Text fragment URLs are
constructed at quote collection time by per-site subagents — they verify the quote exists
on the page and build the fragment from the actual content. Retroactively adding fragments
to existing URLs without re-visiting each source is less reliable.

---

## Best-Effort Partial Migration

If the user wants to upgrade existing artifacts without rerunning:

### Step 1: Update Frontmatter

Update the `skill_version` in the YAML frontmatter of all phase files and the summary:

- `00-inputs.md` → `skill_version: 1.6.0`
- `01-market-snapshot.md` → `skill_version: 1.6.0`
- `02-voice-of-customer.md` → `skill_version: 1.6.0`
- `03-psychographic-profile.md` → `skill_version: 1.6.0`
- `04-awareness-motivation-map.md` → `skill_version: 1.6.0`
- `05-feature-desire-bridge.md` → `skill_version: 1.6.0`
- `research-summary.md` → `skill_version: 1.6.0`

### Step 2: Update CSV Meta

Update `voice-of-customer.csv.meta`:
```yaml
skill_version: 1.6.0
```

### Step 3: Add Text Fragments to Quote URLs (Best-Effort)

For each quote in `02-voice-of-customer.md` and `03-psychographic-profile.md` that has a
source URL:

1. Read the quote text from the attribution line
2. Take a distinctive substring of the quote (under ~100 characters, or use range syntax
   for longer quotes)
3. URL-encode the text and append `#:~:text=` to the existing URL
4. If the URL already has a `#` fragment, insert `:~:text=` after it

For example, transform:
```
1. "I tried everything and nothing stuck." — u/user, [r/productivity](https://reddit.com/abc) (Jan 3, 2025)
```
into:
```
1. "I tried everything and nothing stuck." — u/user, [r/productivity](https://reddit.com/abc#:~:text=I%20tried%20everything%20and%20nothing%20stuck) (Jan 3, 2025)
```

Also update the corresponding `URL` column in `voice-of-customer.csv` to include the text
fragment for each row.

**Note:** This best-effort approach does NOT verify that the text fragment actually matches
content on the page. Some links may not highlight correctly if the source page has changed
since the quote was collected.

---

## Post-Migration Message

After completing all steps, tell the user:

> **Migration complete: v1.5.0 → v1.6.0 (partial)**
>
> Updated:
> - Updated all frontmatter to v1.6.0
> - Added text fragment URLs to quote source links (best-effort, based on quote text)
> - Updated CSV URLs to include text fragments
>
> **What couldn't be migrated automatically:**
> - Text fragment verification (did not re-visit each source URL to confirm the quote still
>   appears on the page — some highlights may not work if pages have changed)
> - Range syntax optimization (long quotes may have full-length fragments instead of the
>   optimized `textStart,textEnd` range syntax that live collection produces)
>
> For verified text fragment URLs, rerun the market-research skill from scratch.
